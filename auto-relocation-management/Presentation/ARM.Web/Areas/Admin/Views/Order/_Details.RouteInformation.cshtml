@model OrderModel

<div class="card detail-info-card direction-info d-card">
    <div class="card-header with-border clearfix">
        <div class="card-title">
            <i class="fas fa-route"></i>
            @T("Admin.Direction")
        </div>
    </div>
    <div class="card-body">
        <div class="form-group">
            <div class="col-md-12">
                @if (!string.IsNullOrWhiteSpace(Model.GoogleAPIKeyForLocation) &&
                    !string.IsNullOrWhiteSpace(Model.PickupAddress.AddressHtml) &&
                    !string.IsNullOrWhiteSpace(Model.ShippingAddress.AddressHtml))
                {
                    <div id="map_canvas" style="height: 300px; width:100%;"></div>

                    <div class="ytJVH rreh">
                        <div class="mGSxre Ra9ql">
                            <div class="lMmzdb">
                                <div class="BbbuR uc9Qxb uE1RRc">
                                    <span class="UdvAnf">
                                        <span id="distance-time" class="iQIYjb myy6W">
                                        </span>
                                        <span id="road-distance">
                                        </span>
                                    </span>
                                    <br class="AzyIKc">
                                </div>
                            </div>
                            <a style="cursor:pointer" target="_blank" href="//www.google.com/maps?saddr=@Model.PickupAddress.AddressHtml&daddr=@(Model.ShippingAddress.AddressHtml)" class="w8gKwf aKK8g4cvHE5__rrenl">
                                <div class="IKKnpb">
                                    <span class="nbuTIc tvbNF"></span>
                                    <div class="udku3">
                                        Directions
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>

                    <script type="text/javascript">

                        if (typeof google === 'undefined' || typeof google.maps === 'undefined') {
                            $.get('@Url.Action("GetGoogleMapsApiKey", "LogisticsCommon")', function (data) {
                                apiKey = data;
                                if (apiKey) {
                                    var googleMapsScript = document.createElement('script');
                                    googleMapsScript.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}`;
                                    document.body.appendChild(googleMapsScript);
                                } else {
                                    toastr.error("Failed to retrieve google map API key.");
                                }
                            });
                        }

                        var waitInterval = setInterval(function () {
                            if (typeof google !== 'undefined' && typeof google.maps !== 'undefined') {
                                clearInterval(waitInterval); // Stop the interval
                                LoadMap();
                            }
                        }, 100);

                        function LoadMap() {
                            DisplayRouteOnMap("map_canvas", "@Html.Raw(Model.PickupAddress.AddressHtml)", "@Html.Raw(Model.ShippingAddress.AddressHtml)", "#distance-time", "#road-distance");
                        }

                    </script>
                }
                else
                {
                    @if (string.IsNullOrWhiteSpace(Model.GoogleAPIKeyForLocation))
                    {
                        @T("Admin.LogisticsQuote.Direction.NoData")
                    }
                    else
                    {
                        @T("Admin.Orders.Direction.Addresses.Missing")
                    }
                }
            </div>
        </div>
    </div>
</div>