@model OrderModel

<div class="card detail-info-card d-card">
	<div class="card-header with-border clearfix">
		<div class="card-title">
			<i class="far fa-sticky-note"></i>
			@T("Admin.Orders.Files")
		</div>
	</div>
	<div class="card-body">
        <div class="card card-default">
            <div class="card-header">
                <i class="fa fa-download d-text-primary mr-1"></i>
                @T("Admin.Orders.Fields.OrderPrivateUpload.AddNew") attachments
            </div>
            <div class="card-body">
                <div class="form-group d-flex d-file-upload">
                    @{
                        ViewData["Endpoint"] = this.Url.Action("OrderPrivateUploadAdd", "Order", new { leadId = Model.LeadId });
                        ViewData["TableSelector"] = "#orderprivateupload-grid";
                    }
                    @* <div class="mr-3">
                    <nop-label asp-for="OrderPrivateUpload.DownloadId" />
                    </div> *@
                    <div>
                        <nop-editor asp-for="OrderPrivateUpload.DownloadId" />
                        <span asp-validation-for="OrderPrivateUpload.DownloadId"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card card-default d-datatable m-0">
            <div class="card-body">
                @await Html.PartialAsync("Table", new DataTablesModel
                {
                    Name = "orderprivateupload-grid",
                    UrlRead = new DataUrl("OrderPrivateUploadList", "Order", new RouteValueDictionary { [nameof(Model.OrderPrivateUploadSearchModel.LeadId)] = Model.LeadId }),
                    //UrlDelete = new DataUrl("OrderPrivateUploadDelete", "Order", null),
                    Length = Model.OrderPrivateUploadSearchModel.PageSize,
                    LengthMenu = Model.OrderPrivateUploadSearchModel.AvailablePageSizes,
                    ColumnCollection = new List<ColumnProperty>
                    {
                        new ColumnProperty(nameof(OrderPrivateUploadModel.FileName))
                        {
                            Title = T("Admin.Orders.Fields.OrderPrivateUpload.FileName").Text,
                        },
                        new ColumnProperty(nameof(OrderPrivateUploadModel.DownloadId))
                        {
                            Title = T("Admin.Orders.Fields.OrderPrivateUpload.DownloadId").Text,
                            Render = new RenderCustom("renderOrderPrivateUploadColumnProductDownloadUrl"),
                            ClassName =  NopColumnClassDefaults.Button
                        },
                        new ColumnProperty(nameof(OrderPrivateUploadModel.Id))
                        {
                            Title = T("Admin.Common.Delete").Text,
                            Width = "100",
                            Render = new RenderCustom("renderColumnFilesDelete"),
                            ClassName =  NopColumnClassDefaults.Button
                        }
                    }
                })

                <script>
                    function renderOrderPrivateUploadColumnProductDownloadUrl(data, type, row, meta) {
                        return (row.DownloadId > 0) ? '<a class="btn btn-default" href="@Url.Content("~/Admin/Download/DownloadFile")?downloadGuid=' + row.DownloadGuid + '"><i class="fas fa-download"></i>@T("Admin.Download.DownloadUploadedFile").Text</a>' : '@T("Admin.Download.DownloadUploadedFile").Text';
                    }
                </script>
            </div>
        </div>
            
    </div>
</div>

<div id="file-delete-confirmation" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="file-delete-confirmation-title" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="filedelete-confirmation-title">@T("Admin.Common.AreYouSure")</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="form-horizontal">
                <div class="modal-body">
                    @T("Admin.Common.DeleteConfirmation")
                </div>
                <div class="modal-footer">
                    <span class="btn btn-default" data-dismiss="modal">@T("Admin.Common.NoCancel")</span>
                    <button asp-action="Edit" type="submit" class="btn btn-danger float-right">@T("Admin.Common.Delete")</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $("#orderprivateupload-grid")
        .on("click", ".delete-file-link", function (e) {
            $("#file-delete-confirmation button[type=submit]").attr("name", $(this).attr("name"));
        });

    $(function () {
        $('#CertificateOfInsuranceDocumentId, #W9DocumentId, #OtherDocumentId').on('change', function () {
            var fileId = $(this).attr("id");
            uploadFile(fileId);
        });
    });
</script>
<script asp-location="Footer">
    function renderColumnFilesDelete(data, type, row, meta) {   
        return '<a name="delete-file-link-' + data + '" class="btn btn-default delete-file-link" data-toggle="modal" data-target="#file-delete-confirmation"><i class="far fa-trash-alt"></i>Delete</a>';
    }
</script>