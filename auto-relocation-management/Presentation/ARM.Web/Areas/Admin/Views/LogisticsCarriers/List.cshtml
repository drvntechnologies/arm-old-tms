@using Nop.Web.Areas.Admin.Models.LogisticsCarriers
@using Nop.Web.Areas.Admin.Models.LogisticsLeads
@model LogisticsCarriersSearchModel
@{
    //page title
    ViewBag.PageTitle = T("Admin.Carriers").Text;
    //active menu item (system name)
    NopHtml.SetActiveMenuItemSystemName("Carriers");
    const string hideSearchBlockAttributeName = "LogisticsCarriersListPage.HideSearchBlock";
    var hideSearchBlock = await genericAttributeService.GetAttributeAsync<bool>(await workContext.GetCurrentCustomerAsync(), hideSearchBlockAttributeName);
}
<form asp-controller="LogisticsCarriers" asp-action="List" method="post" id="carriers-listform">
    <div class="content-header clearfix">
        <h1 class="float-left">
            @T("Admin.Carriers")
        </h1>
        <div class="float-right">
            <a asp-action="Create" class="btn btn-primary">
                <i class="fas fa-plus-square"></i>
                @T("Admin.Common.AddNew")
            </a>           
        </div>
    </div>
    <section class="content">
        <div class="container-fluid">
            <div class="form-horizontal d-form-horizontal">
                <div class="cards-group">
                    <div class="card card-default card-search d-card-search d-card">
                        <div class="card-body">
                            <div class="row search-row @(!hideSearchBlock ? "opened" : "")" data-hideAttribute="@hideSearchBlockAttributeName">
                                <div class="search-text">@T("Admin.Common.Search")</div>
                                <div class="icon-search"><i class="fas fa-search" aria-hidden="true"></i></div>
                                <div class="icon-collapse"><i class="far fa-angle-@(!hideSearchBlock ? "up" : "down")" aria-hidden="true"></i></div>
                            </div>
                            <div class="search-body @(hideSearchBlock ? "closed" : "")">
                                <div class="row">
                                    <div class="col-md-6 col-lg-6 col-xl-3">
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <nop-label asp-for="CompanyLegalName" />
                                            </div>
                                            <div class="col-md-12">
                                                <nop-editor asp-for="CompanyLegalName" html-attributes="@(new { placeholder = "Enter Company Name" })" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-6 col-xl-3">
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <nop-label asp-for="MCNumber" />
                                            </div>
                                            <div class="col-md-12">
                                                <nop-editor asp-for="MCNumber" html-attributes="@(new { placeholder = "Enter MC Number" })" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-6 col-xl-3">
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <nop-label asp-for="DOTNumber" />
                                            </div>
                                            <div class="col-md-12">
                                                <nop-editor asp-for="DOTNumber" html-attributes="@(new { placeholder = "Enter DOT Number" })" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-6 col-xl-3">
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <nop-label asp-for="SCAC" />
                                            </div>
                                            <div class="col-md-12">
                                                <nop-editor asp-for="SCAC" html-attributes="@(new { placeholder = "Enter SCAC" })" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-6 col-xl-3">
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <nop-label asp-for="StateProvinceId" />
                                            </div>
                                            <div class="col-md-12">
                                                <nop-select asp-for="StateProvinceId" asp-items="Model.AvailableStates" class="form-select form-control" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-6 col-xl-3">
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <nop-label asp-for="City" />
                                            </div>
                                            <div class="col-md-12">
                                                <nop-editor asp-for="City" html-attributes="@(new { placeholder = "Enter City" })" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-6 col-xl-3">
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <nop-label asp-for="CountryId" />
                                            </div>
                                            <div class="col-md-12">
                                                <nop-select asp-for="CountryId" asp-items="Model.AvailableCountries" class="form-select form-control" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-6 col-xl-3">
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <nop-label asp-for="PacketStatus" />
                                            </div>
                                            <div class="col-md-12">
                                                <nop-select asp-for="PacketStatus" asp-items="Model.AvailablePacketStatuses" class="form-select form-control" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-6 col-xl-3">
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <nop-label asp-for="InternalRating" />
                                            </div>
                                            <div class="col-md-12">
                                                <nop-select asp-for="InternalRating" asp-items="Model.AvailableInternalRatings" class="form-select form-control" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-6 col-xl-3">
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <nop-label asp-for="MCPRating" />
                                            </div>
                                            <div class="col-md-12">
                                                <nop-select asp-for="MCPRating" asp-items="Model.AvailableMCPRatings" class="form-select form-control" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-6 col-xl-3">
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <nop-label asp-for="CarrierType" />
                                            </div>
                                            <div class="col-md-12">
                                                <nop-select asp-for="CarrierType" asp-items="Model.AvailableCarrierTypes" class="form-select form-control" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-6 col-xl-3">
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <nop-label asp-for="BlockedStatus" />
                                            </div>
                                            <div class="col-md-12">
                                                <nop-select asp-for="BlockedStatus" asp-items="Model.AvailableBlockedStatuses" class="form-select form-control" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-6 col-xl-3">
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <nop-label asp-for="RegionTypeId" />
                                            </div>
                                            <div class="col-md-12">
                                                <nop-select asp-for="RegionTypeId" asp-items="Model.AvailableRegionTypes" class="form-select form-control" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="text-center col-12">
                                        <button type="button" id="search-carriers" class="btn btn-primary btn-search">
                                            <i class="fas fa-search"></i>
                                            @T("Admin.Common.Search")
                                        </button>
                                        <button type="button" id="carrier-btncancel" class="btn btn-primary btn-cancel-search">
                                            <i class="fas fa-times"></i>
                                            @T("Admin.Common.Clear")
                                        </button>
                                    </div>
                                    <script>
                                        cancelSearch("#carrier-btncancel");
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card card-default d-datatable d-card m-0">
                        <div class="card-body">

                            @await Html.PartialAsync("Table", new DataTablesModel
                            {
                                Ordering = true,
                                Order = "0,'desc'",
                                Targets = "2,3,4,5,6,7,8,9,10,11,12,13,14",
                                Orderable = false,
                                Name = "carriers-grid",
                                PrimaryKeyColumn = nameof(LogisticsLeadModel.Id),
                                UrlRead = new DataUrl("LogisticsCarriersList", "LogisticsCarriers", null),
                                SearchButtonId = "search-carriers",
                                Length = Model.PageSize,
                                LengthMenu = Model.AvailablePageSizes,
                                Filters = new List<FilterParameter>
                                {
                                    new FilterParameter(nameof(Model.CompanyLegalName)),
                                    new FilterParameter(nameof(Model.MCNumber)),
                                    new FilterParameter(nameof(Model.DOTNumber)),
                                    new FilterParameter(nameof(Model.SCAC)),
                                    new FilterParameter(nameof(Model.City)),
                                    new FilterParameter(nameof(Model.StateProvinceId)),
                                    new FilterParameter(nameof(Model.CountryId)),
                                    new FilterParameter(nameof(Model.RegionTypeId)),
                                    new FilterParameter(nameof(Model.PacketStatus)),
                                    new FilterParameter(nameof(Model.MCPRating)),
                                    new FilterParameter(nameof(Model.InternalRating)),
                                    new FilterParameter(nameof(Model.CarrierType)),
                                    new FilterParameter(nameof(Model.BlockedStatus)),
                                    // new FilterParameter(nameof(Model.ZipPostalCode)),
                                    //new FilterParameter(nameof(Model.Preference)),
                                },
                                ColumnCollection = new List<ColumnProperty>
                                {   
                                    new ColumnProperty(nameof(LogisticsCarriersModel.Id))
                                    {
                                        Title = T("LogisticsCarrier.Application.Fields.Id").Text,
                                        Visible = false
                                    },
                                    new ColumnProperty(nameof(LogisticsCarriersModel.CompanyLegalName))
                                    {
                                    
                                        Title = $"<span class='d-th'>{T("LogisticsCarrier.Application.Fields.CompanyLegalName").Text}</span>",
                                        Width = "100",
                                        Render = new RenderLink(new DataUrl("Details", nameof(LogisticsCarriersModel.Id)))
                                    },
                                    new ColumnProperty(nameof(LogisticsCarriersModel.DOTNumber))
                                    {
                                    
                                        Title = $"<span class='d-th'>{T("LogisticsCarrier.Application.Fields.DOTNumber").Text}</span>",
                                        Width = "100"
                                    },
                                    new ColumnProperty(nameof(LogisticsCarriersModel.MCNumber))
                                    {
                                    
                                        Title = $"<span class='d-th'>{T("LogisticsCarrier.Application.Fields.ICCNumberMC").Text}</span>",
                                        Width = "100"
                                    },
                                    new ColumnProperty(nameof(LogisticsCarriersModel.Location))
                                    {
                                        Title = T("LogisticsCarrier.Application.Fields.Location").Text,
                                        Width = "100"
                                    },
                                    new ColumnProperty(nameof(LogisticsCarriersModel.SCAC))
                                    {
                                        Title = T("Admin.LogisticsCarrier.Fields.SCAC").Text,
                                        Width = "100"
                                    },
                                    new ColumnProperty(nameof(LogisticsCarriersModel.PacketStatus))
                                    {
                                        Title = T("Admin.LogisticsCarrier.Fields.PacketStatus").Text,
                                        Width = "100"
                                    },
                                    new ColumnProperty(nameof(LogisticsCarriersModel.MCPRating))
                                    {
                                        Title = T("Admin.LogisticsCarrier.Fields.MCPRating").Text,
                                        Width = "100"
                                    },
                                    new ColumnProperty(nameof(LogisticsCarriersModel.InternalRating))
                                    {
                                        Title = T("Admin.LogisticsCarrier.Fields.InternalRating").Text,
                                        Width = "100"
                                    },
                                    new ColumnProperty(nameof(LogisticsCarriersModel.BlockedStatus))
                                    {
                                        Title = T("Admin.LogisticsCarrier.Fields.Blocked").Text,
                                        Width = "100"
                                    },
                                    new ColumnProperty(nameof(LogisticsCarriersModel.CarrierType))
                                    {
                                        Title = T("Admin.LogisticsCarrier.Fields.CarrierType").Text,
                                        Width = "100"
                                    },
                                    new ColumnProperty(nameof(LogisticsCarriersModel.Drivers))
                                    {
                                                        Title = T("Admin.LogisticsCarrier.Fields.Drivers").Text,
                                        Width = "100"
                                    },
                                    new ColumnProperty(nameof(LogisticsCarriersModel.FleetSize))
                                    {
                                        Title = T("Admin.LogisticsCarrier.Fields.FleetSize").Text,
                                        Width = "100"
                                    },
                                    new ColumnProperty(nameof(LogisticsCarriersModel.Trailers))
                                    {
                                        Title = T("Admin.LogisticsCarrier.Fields.Trailers").Text,
                                        Width = "100"
                                    },
                                    // new ColumnProperty(nameof(LogisticsLeadModel.Id))
                                    // {
                                    //     Title = T("Admin.Common.View").Text,
                                    //     Width = "100",
                                    //     ClassName = NopColumnClassDefaults.Button,
                                    //     Render = new RenderButtonView(new DataUrl("~/Admin/LogisticsCarriers/Details/")) 
                                    // },
                                    new ColumnProperty(nameof(LogisticsLeadModel.Id))
                                    {
                                        Title = T("Admin.Common.Action").Text,
                                        Width = "100",
                                        ClassName = NopColumnClassDefaults.Button,
                                        Render = new RenderCustom("renderColumnEditDelete")
                                    },
                                    // new ColumnProperty(nameof(LogisticsLeadModel.Id))
                                    // {
                                    //     Title = T("Admin.Common.Delete").Text,
                                    //     Width = "100",
                                    //     Render = new RenderButtonRemove(T("Admin.Common.Delete").Text),
                                    //     ClassName = NopColumnClassDefaults.Button                                    
                                    // }
                                }
                            })
                        </div>

                        <div id="delete-confirmation" class="modal fade" tabindex="-1" role="dialog">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title">@T("Admin.Common.AreYouSure")</h4>
                                        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
                                    </div>
                                    <div class="modal-body">
                                        <input type="hidden" id="delete-id" name="delete-id" />
                                        @T("Admin.Common.DeleteConfirmation")
                                    </div>
                                    <div class="modal-footer">
                                        <span class="btn btn-default" data-dismiss="modal">@T("Admin.Common.NoCancel")</span>
                                        <button type="button" id="delete-confirmation-popup" class="btn btn-danger">@T("Admin.Common.Delete")</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>
</form>
<script type="text/javascript">
    restrictToCityNameFormat("#City");

    function renderColumnEditDelete(data, type, row, meta) {
        return '<a class=\"btn btn-default\" href=\"Edit/' + data + '\"><i class=\"fas fa-pencil-alt\"title="Edit"></i>Edit</a><a data-deleteId="' + data + '" class="btn btn-default delete-carrier-link" data-toggle="modal" data-target="#delete-confirmation"><i class="far fa-trash-alt" title="Delete"></i>Delete</a>';
    }

    function getStateFromCountry(selectedItem, $stateKendoDropDownList, preSelectedValue = "0"){
        if(!selectedItem || !$stateKendoDropDownList) return false;

        $.ajax({
            cache: false,
            type: "GET",
            url: "@(Url.Action("GetStatesByCountryId", "Country"))",
            data: {
                "countryId": selectedItem,
                "addSelectStateItem": "false"
            },
            success: function (data, textStatus, jqXHR) {
                var dataSource = $stateKendoDropDownList.dataSource;
                dataSource.data([]);
                $.each(data,
                    function (id, option) {
                        dataSource.add({
                            text: option.name,
                            value: option.id
                        });
                    });
                $stateKendoDropDownList.value(preSelectedValue);
            },
            error: function (jqXHR, textStatus, errorThrown) {
            }
        });
    };

    $("#carriers-grid").on("click", ".delete-carrier-link", function (e) {
        const id = $(this).attr("data-deleteId");
        $("#delete-id").val(id);
    });

    $("#delete-confirmation-popup").click(function(){
        var postData = {
            id: $("#delete-id").val()
        };
        addAntiForgeryToken(postData);

        $.post("@Url.Action("DeleteGrid")", postData, function(data){
            $("#delete-id").val("");
            $("#delete-confirmation").find('button.close').click();

            if (data) {
                display_nop_error(data);
            }
            else{
                //refresh grid
                $("#carriers-grid").DataTable().draw(false);
            }
        });
    });

    $("#@Html.IdFor(model => model.CountryId)").change(function () {
        let selectedItem = $(this).data("kendoDropDownList").value();
        let ddlStates = $("#@Html.IdFor(model => model.StateProvinceId)").data("kendoDropDownList");

        getStateFromCountry(selectedItem, ddlStates);
    });
</script>